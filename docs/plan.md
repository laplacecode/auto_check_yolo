# YOLOv5 实时检测系统 - 项目规划

## 项目目标

开发一个基于 YOLOv5 的实时屏幕检测系统,支持屏幕区域录制和实时目标检测。

## 技术方案

### 方案 A: 前端集成方案 (all_in_one/)

**架构**: 前端直接运行 YOLO 检测,无需后端服务器

**优点**:
- 零网络延迟
- 部署简单
- 性能最优
- 适合单机使用

**实现**:
- 前端: PyQt5 + YOLO + MSS
- 检测: 本地直接推理
- 显示: 实时更新 UI

### 方案 B: 前后端分离方案 (src/)

**架构**: 前后端独立,通过 WebRTC 和 WebSocket 通信

**优点**:
- 前后端解耦
- 支持分布式部署
- 易于扩展
- 适合生产环境

**实现**:
- 后端: FastAPI + aiortc + YOLO
- 前端: PyQt5 + WebRTC 客户端
- 通信: WebRTC 视频流 + WebSocket 数据通道

## 核心功能

1. **屏幕区域捕获**
   - 支持自定义区域 (X, Y, 宽度, 高度)
   - 预设配置 (左上角、居中、右半屏)
   - 实时参数调整

2. **YOLO 目标检测**
   - 支持 COCO 80 类物体
   - 实时推理
   - 结果可视化

3. **可视化红框提示**
   - 屏幕叠加层显示捕获区域
   - 呼吸灯动画效果
   - 可开关控制

4. **性能优化**
   - 多线程处理
   - 帧率控制
   - 检测频率调节

## 技术栈

### 前端
- PyQt5 - GUI 框架
- OpenCV - 图像处理
- MSS - 屏幕捕获
- NumPy - 数值计算

### 后端 (方案 B)
- FastAPI - Web 框架
- aiortc - WebRTC 实现
- WebSocket - 实时通信

### AI 模型
- Ultralytics YOLOv5 - 目标检测
- PyTorch - 深度学习框架

## 项目结构

```
auto_check/
├── all_in_one/          # 方案 A: 前端集成
│   ├── detector.py      # 单文件应用
│   ├── start.bat/sh     # 启动脚本
│   └── README.md        # 说明文档
│
├── src/                 # 方案 B: 前后端分离
│   ├── backend/
│   │   └── server.py    # 后端服务
│   ├── frontend/
│   │   └── client.py    # 前端客户端
│   ├── start_*.bat/sh   # 启动脚本
│   └── README.md        # 说明文档
│
├── models/              # 模型文件
│   └── yolov5s.pt
│
├── config/              # 配置文件
│   └── settings.py
│
└── docs/                # 文档
    └── ...
```

## 性能指标

### 方案 A (all_in_one)
- 检测延迟: ~7ms
- 视频帧率: 30 FPS
- 检测频率: 每 5 帧一次
- CPU 占用: 20-40%

### 方案 B (前后端分离)
- 检测延迟: 50-200ms
- 视频帧率: 15 FPS
- 网络带宽: 1-3 Mbps
- CPU 占用: 30-50%

## 开发计划

### 第一阶段: 核心功能 ✅
- [x] 屏幕捕获功能
- [x] YOLO 模型集成
- [x] 基础 UI 界面
- [x] 检测结果显示

### 第二阶段: 方案优化 ✅
- [x] 方案 A: all_in_one 实现
- [x] 方案 B: 前后端分离实现
- [x] 性能优化
- [x] 多线程处理

### 第三阶段: 功能完善 ✅
- [x] 区域预设配置
- [x] 实时参数调整
- [x] 红框可视化提示
- [x] 错误处理

### 第四阶段: 文档和部署 ✅
- [x] 使用文档
- [x] API 文档
- [x] 启动脚本
- [x] 项目重构优化

## 已知问题

1. **WebRTC 兼容性**
   - Windows 环境下 aiortc 可能有兼容性问题
   - 建议使用方案 A (all_in_one)

2. **性能优化**
   - 大分辨率捕获可能影响性能
   - 建议使用较小的捕获区域或降低检测频率

## 后续优化方向

1. **功能扩展**
   - 支持多显示器
   - 支持自定义模型
   - 添加检测过滤器

2. **性能提升**
   - GPU 加速支持
   - 模型量化优化
   - 更高效的视频编码

3. **用户体验**
   - 更友好的 UI 界面
   - 配置文件保存
   - 历史记录功能

## 总结

项目提供两种完整的实现方案:
- **方案 A (all_in_one)**: 简单高效,推荐日常使用
- **方案 B (前后端分离)**: 架构清晰,适合生产部署

根据实际需求选择合适的方案。
